# 웹앱에서 제공하는 1차 캐시!

DB에 실제 물리 데이터가 있다면, 웹앱에 있는 하나의 캐시이다 !

# 메모리 관계도

자바 컬렉션(힙 메모리) - 1차 캐시 - DB 데이터

# 주의할 점

위 세개의 관계에 대한 이해가 되어있지 않다면 운영상에 장애가 났을 때 조치하기 매우 어렵다!

만일 마이바티스 등의 다른 DB 접근 기술등을 같이 사용하고 있다면

```java
em.flush(); // 1차 캐시를 DB에 동기화, 아직 캐시를 비우진 않음
em.clear(); // 1차 캐시를 비운다
```

위 로직을 이용해서 1차 캐시와 DB 데이터를 동기화하는 것이 좋다 !

# 이점

1차 캐시를 사용하면 실제 물리 DB 데이터를 거치는 횟수를 줄일 수 있어서 성능상의 이점이 있다고 한다,

그러나 실제로는 트랜잭션이 수행되는 짧은 사이클에서만 보장되기 때문에 그렇게 실제로 성능상의 이점이 있다고 보기는 어려울 것 같다.

# 2차 캐시

영속성 컨텍스트에는 2차 캐시도 있다

한 트랜잭션에서 보장되는 1차 캐시와는 다르게 2차 캐시는 웹앱 전반에 걸쳐서 캐싱을 한다

**그러나 하이버네이트 2차 캐시의 경우 권장하지는 않는다고 한다**

이유는

- 설정이 복잡하고
- 엔티티 조회와 관련된 부분만 캐시가 지원

된다고 한다

스프링 캐시의 경우 엔티티 뿐만 아니라 DTO도 캐싱할 수 있다고 한다

> 참고) https://www.inflearn.com/questions/33629
